asyncapi: 3.0.0
info:
  title: "ZenWave Online Food Delivery - Channels Menu"
  version: 0.0.1
  tags:
    - name: "Default"
    - name: "Customer"


defaultContentType: application/json

channels:
  CustomerEventsChannel:
    address: "customer.events"
    messages:
      CustomerEventMessage:
        $ref: '#/components/messages/CustomerEventMessage'
  CustomerAddressEventsChannel:
    address: "customer.address-events"
    messages:
      CustomerAddressUpdatedMessage:
        $ref: '#/components/messages/CustomerAddressUpdatedMessage'
  # orders
  CancelOrdersChannel:
    address: "orders.cancel_orders"
    messages:
      CancelOrderInputMessage:
        $ref: '#/components/messages/CancelOrderInputMessage'
  OrdersChannel:
    address: "orders.orders"
    messages:
      OrderEventMessage:
        $ref: '#/components/messages/OrderEventMessage'
  OrderUpdatesChannel:
    address: "orders.order_updates"
    messages:
      OrderStatusUpdatedMessage:
        $ref: '#/components/messages/OrderStatusUpdatedMessage'
  # restaurants
  KitchenOrdersStatusChannel:
    address: "restaurants.kitchen_order_status"
    messages:
      KitchenOrderStatusUpdatedMessage:
        $ref: '#/components/messages/KitchenOrderStatusUpdatedMessage'
  # delivery
  DeliveryStatusChannel:
    address: "delivery.delivery_status"
    messages:
      DeliveryStatusUpdatedMessage:
        $ref: '#/components/messages/DeliveryStatusUpdatedMessage'

components:
  messages:
    CustomerEventMessage:
      name: CustomerEventMessage
      title: ""
      summary: ""
      traits:
        - $ref: '#/components/messageTraits/CommonHeaders'
      payload:
        schemaFormat: application/vnd.aai.asyncapi;version=3.0.0
        schema:
          $ref: "#/components/schemas/CustomerEvent"
    CustomerAddressUpdatedMessage:
      name: CustomerAddressUpdatedMessage
      title: ""
      summary: ""
      traits:
        - $ref: '#/components/messageTraits/CommonHeaders'
      payload:
        schemaFormat: application/vnd.aai.asyncapi;version=3.0.0
        schema:
          $ref: "#/components/schemas/CustomerAddressUpdated"
    # orders
    CancelOrderInputMessage:
      name: CancelOrderInputMessage
      title: ""
      summary: ""
      traits:
        - $ref: '#/components/messageTraits/CommonHeaders'
      payload:
        schemaFormat: application/vnd.aai.asyncapi;version=3.0.0
        schema:
          $ref: "#/components/schemas/CancelOrderInput"
    OrderEventMessage:
      name: OrderEventMessage
      title: ""
      summary: ""
      traits:
        - $ref: '#/components/messageTraits/CommonHeaders'
      payload:
        schemaFormat: application/vnd.aai.asyncapi;version=3.0.0
        schema:
          $ref: "#/components/schemas/OrderEvent"
    OrderStatusUpdatedMessage:
      name: OrderStatusUpdatedMessage
      title: ""
      summary: ""
      traits:
        - $ref: '#/components/messageTraits/CommonHeaders'
      payload:
        schemaFormat: application/vnd.aai.asyncapi;version=3.0.0
        schema:
          $ref: "#/components/schemas/OrderStatusUpdated"
    # restaurants
    KitchenOrderStatusUpdatedMessage:
      name: KitchenOrderStatusUpdatedMessage
      title: ""
      summary: ""
      traits:
        - $ref: '#/components/messageTraits/CommonHeaders'
      payload:
        schemaFormat: application/vnd.aai.asyncapi;version=3.0.0
        schema:
          $ref: "#/components/schemas/KitchenOrderStatusUpdated"
    # delivery
    DeliveryStatusUpdatedMessage:
      name: DeliveryStatusUpdatedMessage
      title: ""
      summary: ""
      traits:
        - $ref: '#/components/messageTraits/CommonHeaders'
      payload:
        schemaFormat: application/vnd.aai.asyncapi;version=3.0.0
        schema:
          $ref: "#/components/schemas/DeliveryStatusUpdated"

  messageTraits:
    CommonHeaders:
      headers:
        type: object
        properties:
          tracingId:
            type: string
            description: This header value will be populated automatically at runtime (when using ZenWave code generator)
            x-runtime-expression: $tracingIdSupplier

  schemas:
    CustomerEvent:
      type: "object"
      x-business-entity: "CustomerEvent"
      properties:
        customerId:
          type: "string"
        eventType:
          $ref: "#/components/schemas/EventType"
        customer:
          $ref: "#/components/schemas/Customer"
    CustomerAddressUpdated:
      type: "object"
      x-business-entity: "CustomerAddressUpdated"
      properties:
        customerId:
          type: "string"
        addressDescription:
          type: "string"
        originalAddress:
          $ref: "#/components/schemas/Address"
        newAddress:
          $ref: "#/components/schemas/Address"
    Address:
      type: "object"
      x-business-entity: "Address"
      required:
        - "identifier"
        - "street"
        - "type"
      properties:
        identifier:
          type: "string"
          description: "Description identifier for this Address"
        street:
          type: "string"
        city:
          type: "string"
        state:
          type: "string"
        zip:
          type: "string"
        type:
          $ref: "#/components/schemas/AddressType"
    EventType:
      type: "string"
      x-business-entity: "EventType"
      enum:
        - "CREATED"
        - "UPDATED"
        - "DELETED"
    Customer:
      type: "object"
      x-business-entity: "Customer"
      required:
        - "firstName"
        - "lastName"
        - "email"
        - "phone"
      properties:
        id:
          type: "string"
        customerId: # this belong to another Customer below (b/c NAME CLASHING)
          type: "string"
        firstName:
          type: "string"
          minLength: 2
          maxLength: 250
          description: "first name javadoc comment"
        lastName:
          type: "string"
          minLength: 2
          maxLength: 250
          description: "last name javadoc comment"
        email:
          type: "string"
          description: "email javadoc comment"
        phone:
          type: "string"
          description: ""
        addresses:
          type: "array"
          items:
            $ref: "#/components/schemas/Address"
    AddressType:
      type: "string"
      x-business-entity: "AddressType"
      enum:
        - "HOME"
        - "WORK"

    # Orders
    OrderEvent:
      type: "object"
      x-business-entity: "OrderEvent"
      properties:
        orderTime:
          type: "string"
          format: "date-time"
        status:
          $ref: "#/components/schemas/OrderStatus"
        customerDetails:
          $ref: "#/components/schemas/Customer"
        restaurantDetails:
          $ref: "#/components/schemas/Restaurant"
        orderItems:
          type: "array"
          items:
            $ref: "#/components/schemas/OrderItem"
        id:
          type: "string"
    OrderStatusUpdated:
      type: "object"
      x-business-entity: "OrderStatusUpdated"
      properties:
        id:
          type: "string"
        dateTime:
          type: "string"
          format: "date-time"
        status:
          $ref: "#/components/schemas/OrderStatus"
        previousStatus:
          $ref: "#/components/schemas/OrderStatus"
    CancelOrderInput:
      type: "object"
      x-business-entity: "CancelOrderInput"
      properties:
        id:
          type: "string"
        reason:
          type: "string"
    Restaurant:
      type: "object"
      x-business-entity: "Restaurant"
      required:
        - "restaurantId"
        - "name"
        - "phone"
      properties:
        restaurantId:
          type: "string"
        name:
          type: "string"
        phone:
          type: "string"
        addresses:
          $ref: "#/components/schemas/Address"
    OrderStatus:
      type: "string"
      x-business-entity: "OrderStatus"
      enum:
        - "RECEIVED"
        - "KITCHEN_ACCEPTED"
        - "DELIVERY_ACCEPTED"
        - "CONFIRMED"
        - "KITCHEN_IN_PROGRESS"
        - "KITCHEN_READY"
        - "KITCHEN_DELIVERED"
        - "ON_DELIVERY"
        - "DELIVERED"
        - "CANCELLED"
    # Address:
    #   type: "object"
    #   x-business-entity: "Address"
    #   required:
    #     - "street"
    #   properties:
    #     street:
    #       type: "string"
    #     city:
    #       type: "string"
    #     state:
    #       type: "string"
    #     zip:
    #       type: "string"
    # Customer:
    #   type: "object"
    #   x-business-entity: "Customer"
    #   required:
    #     - "customerId"
    #     - "firstName"
    #     - "lastName"
    #     - "email"
    #     - "phone"
    #   properties:
    #     customerId:
    #       type: "string"
    #     firstName:
    #       type: "string"
    #     lastName:
    #       type: "string"
    #     email:
    #       type: "string"
    #     phone:
    #       type: "string"
    #     address:
    #       $ref: "#/components/schemas/Address"
    OrderItem:
      type: "object"
      x-business-entity: "OrderItem"
      required:
        - "menuItemId"
        - "name"
        - "price"
        - "quantity"
      properties:
        menuItemId:
          type: "string"
        name:
          type: "string"
        description:
          type: "string"
        price:
          type: "number"
          format: "double"
        quantity:
          type: "integer"
          format: "int32"

    # restaurants
    KitchenOrderStatusUpdated:
      type: "object"
      x-business-entity: "KitchenOrderStatusUpdated"
      required:
        - "customerOrderId"
        - "kitchenOrderId"
        - "status"
      properties:
        customerOrderId:
          type: "string"
        kitchenOrderId:
          type: "string"
        status:
          $ref: "#/components/schemas/KitchenOrderStatus"
        message:
          type: "string"
    KitchenOrderStatus:
      type: "string"
      x-business-entity: "KitchenOrderStatus"
      enum:
        - "ACCEPTED"
        - "REJECTED"
        - "IN_PROGRESS"
        - "READY"
        - "DELIVERED"
        - "CANCELLED"

    # delivery
    DeliveryStatusUpdated:
      type: "object"
      x-business-entity: "DeliveryStatusUpdated"
      required:
        - "customerOrderId"
        - "deliveryId"
        - "status"
      properties:
        customerOrderId:
          type: "string"
        deliveryId:
          type: "string"
        status:
          $ref: "#/components/schemas/DeliveryOrderStatus"
        message:
          type: "string"
    DeliveryOrderStatus:
      type: "string"
      x-business-entity: "DeliveryStatus"
      enum:
        - "ACCEPTED"
        - "REJECTED"
        - "IN_PROGRESS"
        - "READY"
        - "DELIVERED"
        - "CANCELLED"

